<?xml version="1.0" encoding="UTF-8"?>
<project name="biobank2" basedir="." default="sdk">

<!--
  Overall build file

  use command "ant -projecthelp" to display the targets.

-->

<property name="cacore.sdk.dir" location="caCORE_SDK/sdk" />
<property name="eclipse.proj.dir" location="eclipse_ws/biobank2/lib" />
<property name="schema.dir" location="schema" />
<property environment="env"/>

<target name="sdk"
        description="builds the caCORE SDK from the data model" >
  <copy
     file="sdk_conf/deploy.properties"
     tofile="${cacore.sdk.dir}/conf/deploy.properties"/>
  <ant
     dir="${cacore.sdk.dir}"
     target="build-system"
     inheritRefs="false" />
</target>

<target name="deploy-eclipse"
        description="deploys the caCORE SDK beans to the eclipse project"
        depends="sdk">
  <copy
     file="${cacore.sdk.dir}/output/biobank2/build/jar/biobank2-beans.jar"
     tofile="${eclipse.proj.dir}/biobank2-beans.jar"/>
</target>

<target name="deploy-jboss"
        description="deploys the caCORE SDK webapp to JBoss">
  <fail unless="env.JBOSS_HOME" message="$JBOSS_HOME not defined" />
  <antcall target="sdk" />
  <copy
     file="${cacore.sdk.dir}/output/biobank2/package/webapp/biobank2.war"
     tofile="${env.JBOSS_HOME}/server/default/deploy/biobank2.war"/>
</target>

<target
   name="deploy"
   description="deploys to JBoss and Eclipse project">
  <antcall target="deploy-jboss" />
  <antcall target="deploy-eclipse" />
</target>

<target name="schema"
        description="generates the database schema for the caCORE SDK data model"
        depends="sdk">
  <ant
     dir="${schema.dir}"
     target="schemaexport"
     inheritRefs="false" />
</target>

<target name="clean">
  <ant
     dir="${cacore.sdk.dir}"
     target="clean"
     inheritRefs="false" />
</target>

</project>
