<?xml version="1.0" encoding="UTF-8"?>
<project name="biobank2" basedir="." default="sdk">

<!--
  Overall build file

  use command "ant -projecthelp" to display the targets.

-->

<property environment="env"/>
<property name="cacore.sdk.dir" location="caCORE_SDK/sdk" />
<property name="eclipse.proj.dir" location="eclipse_ws/biobank2" />
<property name="data.dir" location="data" />
<property name="data.sql.dir" location="${data.dir}/sql" />
<property name="schema.dir" location="schema" />
<property name="mysql.driver.string" value="org.gjt.mm.mysql.Driver" />
<property name="database.host" value="localhost" />
<property name="database.port" value="3306" />
<property name="database.name" value="biobank2" />
<property name="database.username" value="dummy" />
<property name="database.password" value="ozzy498" />

<target name="sdk"
        description="builds the caCORE SDK from the data model" >
  <copy
     file="sdk_conf/deploy.properties"
     tofile="${cacore.sdk.dir}/conf/deploy.properties"/>
  <ant
     dir="${cacore.sdk.dir}"
     target="build-system"
     inheritRefs="false" />
</target>

<target name="deploy-eclipse"
        description="deploys the caCORE SDK beans to the eclipse project"
        depends="sdk">
  <copy todir="${eclipse.proj.dir}/lib">
    <fileset dir="${cacore.sdk.dir}/output/biobank2/package/remote-client/lib" />
  </copy>
  <copy todir="${eclipse.proj.dir}/conf">
    <fileset dir="${cacore.sdk.dir}/output/biobank2/package/remote-client/conf">
      <include name="application-config-client*.xml" />
    </fileset>
  </copy>
  <copy
     file="${cacore.sdk.dir}/output/biobank2/src/hibernate.cfg.xml"
     tofile="${eclipse.proj.dir}/lib"/>
</target>

<target name="deploy-jboss"
        description="deploys the caCORE SDK webapp to JBoss">
  <fail unless="env.JBOSS_HOME" message="$JBOSS_HOME not defined" />
  <antcall target="sdk" />
  <copy
     file="${cacore.sdk.dir}/output/biobank2/package/webapp/biobank2.war"
     tofile="${env.JBOSS_HOME}/server/default/deploy/biobank2.war"/>
</target>

<target
   name="deploy"
   description="deploys to JBoss and Eclipse project">
  <antcall target="deploy-jboss" />
  <antcall target="deploy-eclipse" />
</target>

<target name="schema"
        description="generates the database schema for the caCORE SDK data model"
        depends="sdk">
  <ant
     dir="${schema.dir}"
     target="schemaexport"
     inheritRefs="false" />
</target>

<target name="dbcreate">
  <antcall target="schema" />
  <sql driver="${mysql.driver.string}"
        url="jdbc:mysql://${database.host}:${database.port}/${database.name}"
        userid="${database.username}" password="${database.password}" >
    <transaction src="${data.sql.dir}/sampleTypes.sql" />
    <transaction src="${data.sql.dir}/sdataTypes.sql" />
    <transaction>commit;</transaction>
    <classpath>
      <fileset dir="${cacore.sdk.dir}/system/lib">
	<include name="*.jar" />
      </fileset>
    </classpath>
  </sql>
</target>

<target name="clean">
  <ant
     dir="${cacore.sdk.dir}"
     target="clean"
     inheritRefs="false" />
</target>

</project>
