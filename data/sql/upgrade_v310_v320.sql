-- start bug#1405 fix
-- add properties for columns and filters for collectionEvent-s and topSpecimen-s

INSERT INTO entity_property VALUES (32, 'processingEvent.worksheet', 1, 1, 0);

INSERT INTO entity_column VALUES (31, 'Processing Event Worksheet', 32, 0);

INSERT INTO entity_filter VALUES (31, 1, 'Processing Event Worksheet', 32, 0);

-- end bug#1405 fix

-- -----------------------------------------------------------------------
--
-- New security / user management
--
-- -----------------------------------------------------------------------

CREATE TABLE bb_group (
    PRINCIPAL_ID INT(11) NOT NULL,
    NAME VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NULL DEFAULT NULL,
    PRIMARY KEY (PRINCIPAL_ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE bb_right (
    ID INT(11) NOT NULL,
    VERSION INT(11) NOT NULL,
    NAME VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NOT NULL,
    FOR_SITE TINYINT(1) NULL DEFAULT NULL,
    FOR_CLINIC TINYINT(1) NULL DEFAULT NULL,
    FOR_RESEARCH_GROUP TINYINT(1) NULL DEFAULT NULL,
    FOR_STUDY TINYINT(1) NULL DEFAULT NULL,
    CONSTRAINT NAME UNIQUE KEY(NAME),
    PRIMARY KEY (ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE group_user (
    USER_ID INT(11) NOT NULL,
    GROUP_ID INT(11) NOT NULL,
    INDEX FK6B1EC1ABB9634A05 (USER_ID),
    INDEX FK6B1EC1AB691634EF (GROUP_ID),
    PRIMARY KEY (GROUP_ID, USER_ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE membership (
    ID INT(11) NOT NULL,
    VERSION INT(11) NOT NULL,
    CENTER_ID INT(11) NULL DEFAULT NULL,
    PRINCIPAL_ID INT(11) NOT NULL,
    STUDY_ID INT(11) NULL DEFAULT NULL,
    INDEX FKCD0773D6F2A2464F (STUDY_ID),
    INDEX FKCD0773D6FF154DAF (PRINCIPAL_ID),
    INDEX FKCD0773D692FAA705 (CENTER_ID),
    PRIMARY KEY (ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE membership_right (
    MEMBERSHIP_ID INT(11) NOT NULL,
    PRIMARY KEY (MEMBERSHIP_ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE membership_role (
    MEMBERSHIP_ID INT(11) NOT NULL,
    PRIMARY KEY (MEMBERSHIP_ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE membership_role_role (
    MEMBERSHIP_ROLE_ID INT(11) NOT NULL,
    ROLE_ID INT(11) NOT NULL,
    INDEX FK6E3AD76D6BCA5F2 (MEMBERSHIP_ROLE_ID),
    INDEX FK6E3AD7614388625 (ROLE_ID),
    PRIMARY KEY (MEMBERSHIP_ROLE_ID, ROLE_ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE principal (
    ID INT(11) NOT NULL,
    VERSION INT(11) NOT NULL,
    PRIMARY KEY (ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE privilege (
    ID INT(11) NOT NULL,
    VERSION INT(11) NOT NULL,
    NAME VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NOT NULL,
    CONSTRAINT NAME UNIQUE KEY(NAME),
    PRIMARY KEY (ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE right_privilege (
    ID INT(11) NOT NULL,
    VERSION INT(11) NOT NULL,
    MEMBERSHIP_RIGHT_ID INT(11) NULL DEFAULT NULL,
    ROLE_ID INT(11) NULL DEFAULT NULL,
    RIGHT_ID INT(11) NOT NULL,
    INDEX FK4B32800E14388625 (ROLE_ID),
    INDEX FK4B32800EF5E5B3CF (RIGHT_ID),
    INDEX FK4B32800EBB1B5B42 (MEMBERSHIP_RIGHT_ID),
    PRIMARY KEY (ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE right_privilege_privilege (
    RIGHT_PRIVILEGE_ID INT(11) NOT NULL,
    PRIVILEGE_ID INT(11) NOT NULL,
    INDEX FKE1E847A0AABB1ACF (PRIVILEGE_ID),
    INDEX FKE1E847A03267910C (RIGHT_PRIVILEGE_ID),
    PRIMARY KEY (RIGHT_PRIVILEGE_ID, PRIVILEGE_ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE role (
    ID INT(11) NOT NULL,
    VERSION INT(11) NOT NULL,
    NAME VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NOT NULL,
    CONSTRAINT NAME UNIQUE KEY(NAME),
    PRIMARY KEY (ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
CREATE TABLE `user` (
    PRINCIPAL_ID INT(11) NOT NULL,
    LOGIN VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NULL DEFAULT NULL,
    CSM_USER_ID BIGINT(20) NULL DEFAULT NULL,
    IS_SUPER_ADMIN TINYINT(1) NULL DEFAULT NULL,
    BULK_EMAILS TINYINT(1) NULL DEFAULT NULL,
    FIRST_NAME VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NULL DEFAULT NULL,
    LAST_NAME VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NULL DEFAULT NULL,
    EMAIL VARCHAR(255) CHARACTER SET latin1 COLLATE latin1_general_cs NULL DEFAULT NULL,
    NEED_CHANGE_PWD TINYINT(1) NULL DEFAULT NULL,
    PRIMARY KEY (PRINCIPAL_ID)
) ENGINE=InnoDB COLLATE=latin1_general_cs;
ALTER TABLE bb_group ADD CONSTRAINT FK119439A0FF154DAF FOREIGN KEY (PRINCIPAL_ID) REFERENCES principal (ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE group_user ADD CONSTRAINT FK6B1EC1AB691634EF FOREIGN KEY (GROUP_ID) REFERENCES bb_group (PRINCIPAL_ID) ON UPDATE NO ACTION ON DELETE NO ACTION, ADD CONSTRAINT FK6B1EC1ABB9634A05 FOREIGN KEY (USER_ID) REFERENCES user (PRINCIPAL_ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE membership ADD CONSTRAINT FKCD0773D692FAA705 FOREIGN KEY (CENTER_ID) REFERENCES center (ID) ON UPDATE NO ACTION ON DELETE NO ACTION, ADD CONSTRAINT FKCD0773D6F2A2464F FOREIGN KEY (STUDY_ID) REFERENCES study (ID) ON UPDATE NO ACTION ON DELETE NO ACTION, ADD CONSTRAINT FKCD0773D6FF154DAF FOREIGN KEY (PRINCIPAL_ID) REFERENCES principal (ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE membership_right ADD CONSTRAINT FKF79CE853D26ABDE5 FOREIGN KEY (MEMBERSHIP_ID) REFERENCES membership (ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE membership_role ADD CONSTRAINT FKEF36B33FD26ABDE5 FOREIGN KEY (MEMBERSHIP_ID) REFERENCES membership (ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE membership_role_role ADD CONSTRAINT FK6E3AD7614388625 FOREIGN KEY (ROLE_ID) REFERENCES role (ID) ON UPDATE NO ACTION ON DELETE NO ACTION, ADD CONSTRAINT FK6E3AD76D6BCA5F2 FOREIGN KEY (MEMBERSHIP_ROLE_ID) REFERENCES membership_role (MEMBERSHIP_ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE right_privilege ADD CONSTRAINT FK4B32800EBB1B5B42 FOREIGN KEY (MEMBERSHIP_RIGHT_ID) REFERENCES membership_right (MEMBERSHIP_ID) ON UPDATE NO ACTION ON DELETE NO ACTION, ADD CONSTRAINT FK4B32800E14388625 FOREIGN KEY (ROLE_ID) REFERENCES role (ID) ON UPDATE NO ACTION ON DELETE NO ACTION, ADD CONSTRAINT FK4B32800EF5E5B3CF FOREIGN KEY (RIGHT_ID) REFERENCES bb_right (ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE right_privilege_privilege ADD CONSTRAINT FKE1E847A03267910C FOREIGN KEY (RIGHT_PRIVILEGE_ID) REFERENCES right_privilege (ID) ON UPDATE NO ACTION ON DELETE NO ACTION, ADD CONSTRAINT FKE1E847A0AABB1ACF FOREIGN KEY (PRIVILEGE_ID) REFERENCES privilege (ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE user ADD CONSTRAINT FK27E3CBFF154DAF FOREIGN KEY (PRINCIPAL_ID) REFERENCES principal (ID) ON UPDATE NO ACTION ON DELETE NO ACTION;
